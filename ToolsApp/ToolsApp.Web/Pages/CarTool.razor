@page "/car-tool"

@inject ICarsData carsInMemoryData

@using ToolsApp.Core.Interfaces.Data
@using ToolsApp.Core.Interfaces.Models
@using ToolsApp.Models
@using ToolsApp.Components.CarTool
@using ToolsApp.Components.Shared

<ToolHeader HeaderText="Car Tool" />

<CarTable Cars="@cars" EditCarId="@editCarId"
  OnSaveCar="@SaveCar" OnCancelCar="@CancelCar"
  OnEditCar="@EditCar" OnDeleteCar="@DeleteCar" />

<CarForm ButtonText="Add Car" OnSubmitCar="@AddCar" />

@code {

  private CarFormModel carForm = new();

  private int editCarId { get; set; } = -1;

  private IEnumerable<ICar> cars { get; set; } = new List<ICar>();

  protected override void OnInitialized()
  {
    cars = carsInMemoryData.All();
  }

  public void EditCar(int carId)
  {
    editCarId = carId;
  }

  public void CancelCar()
  {
    editCarId = -1;
  }

  public void AddCar(INewCar newCar)
  {
    carsInMemoryData.Append(newCar);
    cars = carsInMemoryData.All();
    editCarId = -1;
  }

  public void SaveCar(ICar car)
  {
    carsInMemoryData.Replace(car);
    cars = carsInMemoryData.All();
    editCarId = -1;
  }

  public void DeleteCar(int carId)
  {
    carsInMemoryData.Remove(carId);
    cars = carsInMemoryData.All();
    editCarId = -1;
  }

  class CarFormModel {
    public string Make { get; set; }
    public string Model { get; set; }
    public int Year { get; set; }
    public string Color { get; set; }
    public decimal Price { get; set; }
  }

}
